
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>阿詹國王跳格子</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: linear-gradient(#222, #444);
    }
    canvas {
      display: block;
    }
    #title {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      color: yellow;
      font-family: sans-serif;
      text-shadow: 2px 2px 5px black;
      z-index: 10;
    }
  </style>
</head>
<body>
<div id="title">阿詹國王萬歲</div>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {
  x: canvas.width / 2,
  y: canvas.height - 50,
  w: 40,
  h: 40,
  vx: 0,
  vy: -10,
  jumping: true
};

let platforms = [];
let score = 0;
let gravity = 0.5;
let jumpInterval = 30;
let frameCount = 0;

function createPlatform(x, y, w, h) {
  return { x, y, w, h };
}

function initPlatforms() {
  platforms = [];
  let y = canvas.height - 50;
  for (let i = 0; i < 10; i++) {
    platforms.push(createPlatform(Math.random() * (canvas.width - 100), y, 100, 10));
    y -= 100;
  }
}

function drawPlayer() {
  ctx.fillStyle = "#FFD700";
  ctx.fillRect(player.x, player.y, player.w, player.h);
  // 頭盔
  ctx.fillStyle = "#FFA500";
  ctx.fillRect(player.x, player.y, player.w, 10);
}

function drawPlatforms() {
  ctx.fillStyle = "#888";
  platforms.forEach(p => {
    ctx.fillRect(p.x, p.y, p.w, p.h);
  });
}

function updatePlayer() {
  player.vy += gravity;
  player.y += player.vy;
  player.x += player.vx;

  if (player.x < 0) player.x = 0;
  if (player.x + player.w > canvas.width) player.x = canvas.width - player.w;

  for (let p of platforms) {
    if (
      player.vy > 0 &&
      player.x + player.w > p.x &&
      player.x < p.x + p.w &&
      player.y + player.h > p.y &&
      player.y + player.h < p.y + p.h
    ) {
      player.vy = -10;
      score++;
    }
  }

  if (player.y > canvas.height) {
    alert("阿詹國王掉下去了！你跳了 " + score + " 格！");
    document.location.reload();
  }
}

function drawScore() {
  ctx.fillStyle = "white";
  ctx.font = "18px sans-serif";
  ctx.fillText("跳了 " + score + " 格", 20, 40);
}

function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawPlatforms();
  updatePlayer();
  drawPlayer();
  drawScore();
  frameCount++;
  if (frameCount % jumpInterval === 0) {
    player.vy = -10;
  }
  requestAnimationFrame(gameLoop);
}

function moveLeft() {
  player.vx = -5;
}

function moveRight() {
  player.vx = 5;
}

function stopMove() {
  player.vx = 0;
}

window.addEventListener("keydown", e => {
  if (e.key === "ArrowLeft") moveLeft();
  if (e.key === "ArrowRight") moveRight();
});
window.addEventListener("keyup", stopMove);

// 手機觸控控制左右
canvas.addEventListener("touchstart", function(e) {
  const x = e.touches[0].clientX;
  if (x < canvas.width / 2) {
    moveLeft();
  } else {
    moveRight();
  }
});
canvas.addEventListener("touchend", stopMove);

initPlatforms();
gameLoop();
</script>
</body>
</html>
