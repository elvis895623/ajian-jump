
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>阿詹國王跳格子</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: sans-serif; }
    canvas { display: block; background: #f0f0f0; }
    #gameOver {
      position: absolute; top: 40%; width: 100%; text-align: center;
      font-size: 32px; display: none;
    }
    #restartBtn {
      font-size: 20px; padding: 10px 20px; margin-top: 20px;
    }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="400" height="600"></canvas>
<div id="gameOver">
  <div>阿詹國王掉下去了！</div>
  <div id="score"></div>
  <button id="restartBtn" onclick="restartGame()">再戰！</button>
</div>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x: 200, y: 500, size: 20, vy: 0, isJumping: false };
let gravity = 0.8;
let jumpPower = -12;
let platforms = [];
let gameOver = false;
let score = 0;

function createPlatform(x, y, w = 80, h = 10) {
  return { x, y, w, h };
}

function initPlatforms() {
  platforms = [];
  for (let i = 0; i < 5; i++) {
    platforms.push(createPlatform(100 + Math.random() * 200 - 100, 550 - i * 100));
  }
}

function drawPlayer() {
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
  ctx.fill();
}

function drawPlatforms() {
  ctx.fillStyle = "gray";
  platforms.forEach(p => {
    ctx.fillRect(p.x, p.y, p.w, p.h);
  });
}

function updatePlayer() {
  player.vy += gravity;
  player.y += player.vy;

  platforms.forEach(p => {
    if (
      player.x > p.x &&
      player.x < p.x + p.w &&
      player.y + player.size >= p.y &&
      player.y + player.size <= p.y + p.h &&
      player.vy > 0
    ) {
      player.vy = 0;
      player.y = p.y - player.size;
      player.isJumping = false;
    }
  });

  if (player.y > canvas.height) {
    endGame();
  }
}

function drawScore() {
  ctx.fillStyle = "black";
  ctx.font = "16px sans-serif";
  ctx.fillText("跳了 " + score + " 格", 10, 20);
}

function gameLoop() {
  if (gameOver) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  updatePlayer();
  drawPlatforms();
  drawPlayer();
  drawScore();
  requestAnimationFrame(gameLoop);
}

function jump() {
  if (!player.isJumping && !gameOver) {
    player.vy = jumpPower;
    player.isJumping = true;
    score++;
    movePlatforms();
  }
}

function movePlatforms() {
  platforms.forEach(p => {
    p.y += 50;
    if (p.y > canvas.height) {
      p.y = 0;
      p.x = Math.random() * (canvas.width - 80);
    }
  });
}

function endGame() {
  gameOver = true;
  document.getElementById("gameOver").style.display = "block";
  document.getElementById("score").innerText = "你跳了 " + score + " 格";
}

function restartGame() {
  player.x = 200;
  player.y = 500;
  player.vy = 0;
  player.isJumping = false;
  score = 0;
  gameOver = false;
  document.getElementById("gameOver").style.display = "none";
  initPlatforms();
  gameLoop();
}

canvas.addEventListener("click", jump);

initPlatforms();
gameLoop();
</script>
</body>
</html>
